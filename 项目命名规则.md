# 政府采购项目审查分析系统命名规则

为确保政府采购项目审查分析系统代码的清晰、一致和可维护性，所有贡献者都应遵循以下命名规则。本系统包含RBAC权限控制、项目管理、文档管理、OCR文字识别和AI智能分析等核心功能模块。

## 🆕 AI集成版本更新 (v1.1.0)

本版本新增AI服务模块，包含文档向量化、语义搜索、智能分析等功能，相关命名规范已更新。

## 1. 通用规则

*   **语言**: 除非特殊说明，所有命名均使用 **英文**。
*   **大小写**: 遵循特定场景下的大小写规范（见下文），避免混合使用多种风格。

## 2. 文件和目录命名

*   **目录**: 使用 **小写蛇形命名法 (snake_case)**，例如 `app/api/v1/endpoints`。
*   **Python文件**: 使用 **小写蛇形命名法 (snake_case)**，例如 `crud_user.py`。
*   **非Python文件** (如文档, 配置文件): 可使用 **烤肉串命名法 (kebab-case)** 或 **大写驼峰命名法 (PascalCase)**，但应在同类文件中保持一致。例如 `README.md`, `alembic.ini`。

## 3. Python 代码命名

### 3.1. 变量

*   **普通变量**: 使用 **小写蛇形命名法 (snake_case)**。
    ```python
    current_user: models.User = Depends(deps.get_current_user)
    ```
*   **常量**: 使用 **全大写蛇形命名法 (UPPER_SNAKE_CASE)**。
    ```python
    API_V1_STR: str = "/api/v1"
    ALGORITHM: str = "HS256"
    ```

### 3.2. 函数和方法

*   使用 **小写蛇形命名法 (snake_case)**。
    ```python
    def get_current_user():
        pass

    def create_user(db: Session, *, obj_in: UserCreate) -> models.User:
        pass
    ```

### 3.3. 类

*   使用 **大写驼峰命名法 (PascalCase)**。
    ```python
    class User(Base):
        pass

    class ProjectCreate(ProjectBase):
        pass
    ```

### 3.4. Pydantic 模型

*   **基础模型**: 以 `Base` 结尾，例如 `UserBase`。
*   **创建模型**: 以 `Create` 结尾，例如 `UserCreate`。
*   **更新模型**: 以 `Update` 结尾，例如 `UserUpdate`。
*   **数据库模型**: 以 `InDB` 或 `InDBBase` 结尾，例如 `UserInDB`。

## 4. 数据库命名

*   **表名**: 使用 **小写蛇形命名法 (snake_case)**，通常是模型名的小写复数形式，例如 `users`, `projects`。
*   **列名**: 使用 **小写蛇形命名法 (snake_case)**，例如 `full_name`, `is_superuser`。
*   **外键**: 使用 `_id` 后缀，例如 `owner_id`。

## 5. API 端点命名

*   **路径**: 使用 **小写蛇形命名法 (snake_case)**，并使用复数形式表示资源集合，例如 `/api/v1/users/`。
*   **路径参数**: 使用 **小写蛇形命名法 (snake_case)**，例如 `/api/v1/projects/{project_id}`。

## 6. 功能模块命名约定

### 6.1. 文档管理模块
*   **模型**: `Document`, `DocumentAnnotation`, `ComplianceCheck`
*   **Schema**: `DocumentBase`, `DocumentCreate`, `DocumentUpdate`, `DocumentInDB`
*   **CRUD**: `crud_document.py`
*   **API端点**: `/api/v1/documents/`

### 6.2. OCR功能模块
*   **模型**: `OCRResult`
*   **Schema**: `OCRResultBase`, `OCRResultCreate`, `OCRResultUpdate`, `OCRResultInDB`
*   **CRUD**: `crud_ocr.py`
*   **服务**: `ocr_service.py`
*   **API端点**: `/api/v1/ocr/`

### 6.3. 项目管理模块
*   **模型**: `Project`, `Issue`, `ProjectComparison`
*   **Schema**: `ProjectBase`, `ProjectCreate`, `IssueBase`, `ProjectComparisonBase`
*   **CRUD**: `crud_project.py`
*   **API端点**: `/api/v1/projects/`, `/api/v1/issues/`

### 6.4. 用户权限模块
*   **模型**: `User`
*   **Schema**: `UserBase`, `UserCreate`, `UserUpdate`, `UserInDB`
*   **CRUD**: `crud_user.py`
*   **API端点**: `/api/v1/users/`, `/api/v1/login/`

### 6.5. AI服务模块 (新增)
*   **服务目录**: `ai_service/`
*   **模型**: `DocumentVector`, `VectorSearchIndex`, `SearchQuery`, `KnowledgeGraph`
*   **Schema**: `VectorBase`, `VectorCreate`, `SearchQueryBase`, `SearchResultBase`
*   **CRUD**: `crud_vector.py`
*   **服务**: `vectorization.py`, `search.py`
*   **API端点**: `/api/vectorization/`, `/api/search/`, `/api/health/`

#### AI服务命名细则

**向量化相关**
```python
# 函数命名
def vectorize_text(text: str) -> List[float]:
def vectorize_document(document_id: int) -> VectorResult:
def batch_vectorize_documents(document_ids: List[int]) -> BatchVectorResult:

# 类命名
class VectorService:
class EmbeddingModel:
class VectorStore:
```

**搜索相关**
```python
# 函数命名
def semantic_search(query: str, limit: int = 10) -> SearchResult:
def vector_similarity_search(vector: List[float]) -> List[SimilarDocument]:
def hybrid_search(query: str, filters: Dict) -> SearchResult:

# 类命名
class SearchService:
class QueryProcessor:
class ResultRanker:
```

**AI模型相关**
```python
# 常量命名
DEFAULT_EMBEDDING_MODEL = "bge-m3:latest"
VECTOR_DIMENSION = 1024
MAX_CHUNK_SIZE = 512
SIMILARITY_THRESHOLD = 0.7

# 配置类
class AIConfig:
class OllamaConfig:
class VectorDBConfig:
```

## 7. 环境和配置命名

### 7.1. 环境变量
*   使用 **全大写蛇形命名法 (UPPER_SNAKE_CASE)**
*   按功能分组，使用前缀区分

```env
# 数据库配置
DATABASE_URL=postgresql://user:password@localhost:5432/audit_system
TEST_DATABASE_URL=postgresql://user:password@localhost:5432/audit_system_test

# AI服务配置
OLLAMA_BASE_URL=http://localhost:11434
DEFAULT_EMBEDDING_MODEL=bge-m3:latest
AI_SERVICE_URL=http://localhost:8001

# Redis配置
REDIS_URL=redis://localhost:6379
REDIS_CACHE_TTL=3600

# Azure OpenAI配置
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=your-endpoint
AZURE_OPENAI_API_VERSION=2023-12-01-preview
```

### 7.2. Docker服务命名
*   使用 **小写烤肉串命名法 (kebab-case)**

```yaml
services:
  app:              # 主应用服务
  ai-service:       # AI服务模块
  ollama:           # Ollama LLM服务
  postgres:         # PostgreSQL数据库
  redis:            # Redis缓存
  nginx:            # Nginx反向代理
```

## 8. 测试文件命名

### 8.1. 测试文件
*   使用 `test_` 前缀 + **小写蛇形命名法**

```python
# 单元测试
test_user_crud.py
test_document_service.py
test_vectorization.py
test_search_api.py

# 集成测试
test_document_vectorization.py
test_ai_functionality.py
test_document_workflow.py

# 性能测试
test_vector_performance.py
test_search_performance.py
```

### 8.2. 测试函数
*   使用 `test_` 前缀 + 描述性名称

```python
def test_create_user_success():
def test_vectorize_document_with_valid_content():
def test_semantic_search_returns_relevant_results():
def test_batch_vectorization_handles_large_documents():
```

## 9. 日志和监控命名

### 9.1. 日志记录器
```python
# 按模块命名
logger = logging.getLogger("app.api.v1.users")
logger = logging.getLogger("ai_service.vectorization")
logger = logging.getLogger("ai_service.search")
```

### 9.2. 监控指标
```python
# Prometheus指标命名
api_requests_total = Counter('api_requests_total')
vectorization_duration_seconds = Histogram('vectorization_duration_seconds')
search_requests_total = Counter('search_requests_total')
embedding_model_errors_total = Counter('embedding_model_errors_total')
```

## 10. 文档和注释规范

### 10.1. 文档文件
*   使用 **大写驼峰命名法 (PascalCase)** 或 **全大写**

```
README.md
DEVELOPMENT.md
DEPLOYMENT.md
AI_INTEGRATION_GUIDE.md
VECTOR_DATABASE_SETUP.md
```

### 10.2. 代码注释
*   函数和类使用英文文档字符串
*   复杂逻辑使用中文注释说明

```python
def vectorize_document(document_id: int) -> VectorResult:
    """Vectorize a document using the default embedding model.
    
    Args:
        document_id: The ID of the document to vectorize
        
    Returns:
        VectorResult containing the vector and metadata
        
    Raises:
        DocumentNotFoundError: If document doesn't exist
        VectorizationError: If vectorization fails
    """
    # 获取文档内容并进行预处理
    document = get_document_by_id(document_id)
    
    # 使用AI模型进行向量化处理
    vector = embedding_model.encode(document.content)
    
    return VectorResult(vector=vector, document_id=document_id)
```

---

**最后更新**: 2025-07-27  
**版本**: v1.1.0 (AI集成版本)  
**适用范围**: 政府采购项目审查分析系统  
**维护团队**: 开发团队
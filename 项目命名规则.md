# æ”¿åºœé‡‡è´­é¡¹ç›®å®¡æŸ¥åˆ†æç³»ç»Ÿå‘½åè§„åˆ™

ä¸ºç¡®ä¿æ”¿åºœé‡‡è´­é¡¹ç›®å®¡æŸ¥åˆ†æç³»ç»Ÿä»£ç çš„æ¸…æ™°ã€ä¸€è‡´å’Œå¯ç»´æŠ¤æ€§ï¼Œæ‰€æœ‰è´¡çŒ®è€…éƒ½åº”éµå¾ªä»¥ä¸‹å‘½åè§„åˆ™ã€‚æœ¬ç³»ç»ŸåŒ…å«RBACæƒé™æ§åˆ¶ã€é¡¹ç›®ç®¡ç†ã€æ–‡æ¡£ç®¡ç†ã€OCRæ–‡å­—è¯†åˆ«å’ŒAIæ™ºèƒ½åˆ†æç­‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ã€‚

## ğŸ†• AIé›†æˆç‰ˆæœ¬æ›´æ–° (v1.1.0)

æœ¬ç‰ˆæœ¬æ–°å¢AIæœåŠ¡æ¨¡å—ï¼ŒåŒ…å«æ–‡æ¡£å‘é‡åŒ–ã€è¯­ä¹‰æœç´¢ã€æ™ºèƒ½åˆ†æç­‰åŠŸèƒ½ï¼Œç›¸å…³å‘½åè§„èŒƒå·²æ›´æ–°ã€‚

## 1. é€šç”¨è§„åˆ™

*   **è¯­è¨€**: é™¤éç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æœ‰å‘½åå‡ä½¿ç”¨ **è‹±æ–‡**ã€‚
*   **å¤§å°å†™**: éµå¾ªç‰¹å®šåœºæ™¯ä¸‹çš„å¤§å°å†™è§„èŒƒï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œé¿å…æ··åˆä½¿ç”¨å¤šç§é£æ ¼ã€‚

## 2. æ–‡ä»¶å’Œç›®å½•å‘½å

*   **ç›®å½•**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ï¼Œä¾‹å¦‚ `app/api/v1/endpoints`ã€‚
*   **Pythonæ–‡ä»¶**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ï¼Œä¾‹å¦‚ `crud_user.py`ã€‚
*   **éPythonæ–‡ä»¶** (å¦‚æ–‡æ¡£, é…ç½®æ–‡ä»¶): å¯ä½¿ç”¨ **çƒ¤è‚‰ä¸²å‘½åæ³• (kebab-case)** æˆ– **å¤§å†™é©¼å³°å‘½åæ³• (PascalCase)**ï¼Œä½†åº”åœ¨åŒç±»æ–‡ä»¶ä¸­ä¿æŒä¸€è‡´ã€‚ä¾‹å¦‚ `README.md`, `alembic.ini`ã€‚

## 3. Python ä»£ç å‘½å

### 3.1. å˜é‡

*   **æ™®é€šå˜é‡**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ã€‚
    ```python
    current_user: models.User = Depends(deps.get_current_user)
    ```
*   **å¸¸é‡**: ä½¿ç”¨ **å…¨å¤§å†™è›‡å½¢å‘½åæ³• (UPPER_SNAKE_CASE)**ã€‚
    ```python
    API_V1_STR: str = "/api/v1"
    ALGORITHM: str = "HS256"
    ```

### 3.2. å‡½æ•°å’Œæ–¹æ³•

*   ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ã€‚
    ```python
    def get_current_user():
        pass

    def create_user(db: Session, *, obj_in: UserCreate) -> models.User:
        pass
    ```

### 3.3. ç±»

*   ä½¿ç”¨ **å¤§å†™é©¼å³°å‘½åæ³• (PascalCase)**ã€‚
    ```python
    class User(Base):
        pass

    class ProjectCreate(ProjectBase):
        pass
    ```

### 3.4. Pydantic æ¨¡å‹

*   **åŸºç¡€æ¨¡å‹**: ä»¥ `Base` ç»“å°¾ï¼Œä¾‹å¦‚ `UserBase`ã€‚
*   **åˆ›å»ºæ¨¡å‹**: ä»¥ `Create` ç»“å°¾ï¼Œä¾‹å¦‚ `UserCreate`ã€‚
*   **æ›´æ–°æ¨¡å‹**: ä»¥ `Update` ç»“å°¾ï¼Œä¾‹å¦‚ `UserUpdate`ã€‚
*   **æ•°æ®åº“æ¨¡å‹**: ä»¥ `InDB` æˆ– `InDBBase` ç»“å°¾ï¼Œä¾‹å¦‚ `UserInDB`ã€‚

## 4. æ•°æ®åº“å‘½å

*   **è¡¨å**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ï¼Œé€šå¸¸æ˜¯æ¨¡å‹åçš„å°å†™å¤æ•°å½¢å¼ï¼Œä¾‹å¦‚ `users`, `projects`ã€‚
*   **åˆ—å**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ï¼Œä¾‹å¦‚ `full_name`, `is_superuser`ã€‚
*   **å¤–é”®**: ä½¿ç”¨ `_id` åç¼€ï¼Œä¾‹å¦‚ `owner_id`ã€‚

## 5. API ç«¯ç‚¹å‘½å

*   **è·¯å¾„**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ï¼Œå¹¶ä½¿ç”¨å¤æ•°å½¢å¼è¡¨ç¤ºèµ„æºé›†åˆï¼Œä¾‹å¦‚ `/api/v1/users/`ã€‚
*   **è·¯å¾„å‚æ•°**: ä½¿ç”¨ **å°å†™è›‡å½¢å‘½åæ³• (snake_case)**ï¼Œä¾‹å¦‚ `/api/v1/projects/{project_id}`ã€‚

## 6. åŠŸèƒ½æ¨¡å—å‘½åçº¦å®š

### 6.1. æ–‡æ¡£ç®¡ç†æ¨¡å—
*   **æ¨¡å‹**: `Document`, `DocumentAnnotation`, `ComplianceCheck`
*   **Schema**: `DocumentBase`, `DocumentCreate`, `DocumentUpdate`, `DocumentInDB`
*   **CRUD**: `crud_document.py`
*   **APIç«¯ç‚¹**: `/api/v1/documents/`

### 6.2. OCRåŠŸèƒ½æ¨¡å—
*   **æ¨¡å‹**: `OCRResult`
*   **Schema**: `OCRResultBase`, `OCRResultCreate`, `OCRResultUpdate`, `OCRResultInDB`
*   **CRUD**: `crud_ocr.py`
*   **æœåŠ¡**: `ocr_service.py`
*   **APIç«¯ç‚¹**: `/api/v1/ocr/`

### 6.3. é¡¹ç›®ç®¡ç†æ¨¡å—
*   **æ¨¡å‹**: `Project`, `Issue`, `ProjectComparison`
*   **Schema**: `ProjectBase`, `ProjectCreate`, `IssueBase`, `ProjectComparisonBase`
*   **CRUD**: `crud_project.py`
*   **APIç«¯ç‚¹**: `/api/v1/projects/`, `/api/v1/issues/`

### 6.4. ç”¨æˆ·æƒé™æ¨¡å—
*   **æ¨¡å‹**: `User`
*   **Schema**: `UserBase`, `UserCreate`, `UserUpdate`, `UserInDB`
*   **CRUD**: `crud_user.py`
*   **APIç«¯ç‚¹**: `/api/v1/users/`, `/api/v1/login/`

### 6.5. AIæœåŠ¡æ¨¡å— (æ–°å¢)
*   **æœåŠ¡ç›®å½•**: `ai_service/`
*   **æ¨¡å‹**: `DocumentVector`, `VectorSearchIndex`, `SearchQuery`, `KnowledgeGraph`
*   **Schema**: `VectorBase`, `VectorCreate`, `SearchQueryBase`, `SearchResultBase`
*   **CRUD**: `crud_vector.py`
*   **æœåŠ¡**: `vectorization.py`, `search.py`
*   **APIç«¯ç‚¹**: `/api/vectorization/`, `/api/search/`, `/api/health/`

#### AIæœåŠ¡å‘½åç»†åˆ™

**å‘é‡åŒ–ç›¸å…³**
```python
# å‡½æ•°å‘½å
def vectorize_text(text: str) -> List[float]:
def vectorize_document(document_id: int) -> VectorResult:
def batch_vectorize_documents(document_ids: List[int]) -> BatchVectorResult:

# ç±»å‘½å
class VectorService:
class EmbeddingModel:
class VectorStore:
```

**æœç´¢ç›¸å…³**
```python
# å‡½æ•°å‘½å
def semantic_search(query: str, limit: int = 10) -> SearchResult:
def vector_similarity_search(vector: List[float]) -> List[SimilarDocument]:
def hybrid_search(query: str, filters: Dict) -> SearchResult:

# ç±»å‘½å
class SearchService:
class QueryProcessor:
class ResultRanker:
```

**AIæ¨¡å‹ç›¸å…³**
```python
# å¸¸é‡å‘½å
DEFAULT_EMBEDDING_MODEL = "bge-m3:latest"
VECTOR_DIMENSION = 1024
MAX_CHUNK_SIZE = 512
SIMILARITY_THRESHOLD = 0.7

# é…ç½®ç±»
class AIConfig:
class OllamaConfig:
class VectorDBConfig:
```

## 7. ç¯å¢ƒå’Œé…ç½®å‘½å

### 7.1. ç¯å¢ƒå˜é‡
*   ä½¿ç”¨ **å…¨å¤§å†™è›‡å½¢å‘½åæ³• (UPPER_SNAKE_CASE)**
*   æŒ‰åŠŸèƒ½åˆ†ç»„ï¼Œä½¿ç”¨å‰ç¼€åŒºåˆ†

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/audit_system
TEST_DATABASE_URL=postgresql://user:password@localhost:5432/audit_system_test

# AIæœåŠ¡é…ç½®
OLLAMA_BASE_URL=http://localhost:11434
DEFAULT_EMBEDDING_MODEL=bge-m3:latest
AI_SERVICE_URL=http://localhost:8001

# Redisé…ç½®
REDIS_URL=redis://localhost:6379
REDIS_CACHE_TTL=3600

# Azure OpenAIé…ç½®
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=your-endpoint
AZURE_OPENAI_API_VERSION=2023-12-01-preview
```

### 7.2. DockeræœåŠ¡å‘½å
*   ä½¿ç”¨ **å°å†™çƒ¤è‚‰ä¸²å‘½åæ³• (kebab-case)**

```yaml
services:
  app:              # ä¸»åº”ç”¨æœåŠ¡
  ai-service:       # AIæœåŠ¡æ¨¡å—
  ollama:           # Ollama LLMæœåŠ¡
  postgres:         # PostgreSQLæ•°æ®åº“
  redis:            # Redisç¼“å­˜
  nginx:            # Nginxåå‘ä»£ç†
```

## 8. æµ‹è¯•æ–‡ä»¶å‘½å

### 8.1. æµ‹è¯•æ–‡ä»¶
*   ä½¿ç”¨ `test_` å‰ç¼€ + **å°å†™è›‡å½¢å‘½åæ³•**

```python
# å•å…ƒæµ‹è¯•
test_user_crud.py
test_document_service.py
test_vectorization.py
test_search_api.py

# é›†æˆæµ‹è¯•
test_document_vectorization.py
test_ai_functionality.py
test_document_workflow.py

# æ€§èƒ½æµ‹è¯•
test_vector_performance.py
test_search_performance.py
```

### 8.2. æµ‹è¯•å‡½æ•°
*   ä½¿ç”¨ `test_` å‰ç¼€ + æè¿°æ€§åç§°

```python
def test_create_user_success():
def test_vectorize_document_with_valid_content():
def test_semantic_search_returns_relevant_results():
def test_batch_vectorization_handles_large_documents():
```

## 9. æ—¥å¿—å’Œç›‘æ§å‘½å

### 9.1. æ—¥å¿—è®°å½•å™¨
```python
# æŒ‰æ¨¡å—å‘½å
logger = logging.getLogger("app.api.v1.users")
logger = logging.getLogger("ai_service.vectorization")
logger = logging.getLogger("ai_service.search")
```

### 9.2. ç›‘æ§æŒ‡æ ‡
```python
# PrometheusæŒ‡æ ‡å‘½å
api_requests_total = Counter('api_requests_total')
vectorization_duration_seconds = Histogram('vectorization_duration_seconds')
search_requests_total = Counter('search_requests_total')
embedding_model_errors_total = Counter('embedding_model_errors_total')
```

## 10. æ–‡æ¡£å’Œæ³¨é‡Šè§„èŒƒ

### 10.1. æ–‡æ¡£æ–‡ä»¶
*   ä½¿ç”¨ **å¤§å†™é©¼å³°å‘½åæ³• (PascalCase)** æˆ– **å…¨å¤§å†™**

```
README.md
DEVELOPMENT.md
DEPLOYMENT.md
AI_INTEGRATION_GUIDE.md
VECTOR_DATABASE_SETUP.md
```

### 10.2. ä»£ç æ³¨é‡Š
*   å‡½æ•°å’Œç±»ä½¿ç”¨è‹±æ–‡æ–‡æ¡£å­—ç¬¦ä¸²
*   å¤æ‚é€»è¾‘ä½¿ç”¨ä¸­æ–‡æ³¨é‡Šè¯´æ˜

```python
def vectorize_document(document_id: int) -> VectorResult:
    """Vectorize a document using the default embedding model.
    
    Args:
        document_id: The ID of the document to vectorize
        
    Returns:
        VectorResult containing the vector and metadata
        
    Raises:
        DocumentNotFoundError: If document doesn't exist
        VectorizationError: If vectorization fails
    """
    # è·å–æ–‡æ¡£å†…å®¹å¹¶è¿›è¡Œé¢„å¤„ç†
    document = get_document_by_id(document_id)
    
    # ä½¿ç”¨AIæ¨¡å‹è¿›è¡Œå‘é‡åŒ–å¤„ç†
    vector = embedding_model.encode(document.content)
    
    return VectorResult(vector=vector, document_id=document_id)
```

---

**æœ€åæ›´æ–°**: 2025-07-27  
**ç‰ˆæœ¬**: v1.1.0 (AIé›†æˆç‰ˆæœ¬)  
**é€‚ç”¨èŒƒå›´**: æ”¿åºœé‡‡è´­é¡¹ç›®å®¡æŸ¥åˆ†æç³»ç»Ÿ  
**ç»´æŠ¤å›¢é˜Ÿ**: å¼€å‘å›¢é˜Ÿ